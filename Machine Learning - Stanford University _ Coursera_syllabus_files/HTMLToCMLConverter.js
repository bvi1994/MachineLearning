define("bundles/cml/models/HTMLToCMLConverter",["require","exports","module","underscore","./CMLParser","./HTMLToCMLConverter/Text","./HTMLToCMLConverter/Code","./HTMLToCMLConverter/Image","./HTMLToCMLConverter/Table","./HTMLToCMLConverter/Asset","./HTMLToCMLConverter/Heading","./HTMLToCMLConverter/List"],function(require,exports,module){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _=require("underscore"),s=require("./CMLParser"),c=require("./HTMLToCMLConverter/Text"),o=require("./HTMLToCMLConverter/Code"),t=require("./HTMLToCMLConverter/Image"),a=require("./HTMLToCMLConverter/Table"),n=require("./HTMLToCMLConverter/Asset"),e=require("./HTMLToCMLConverter/Heading"),r=require("./HTMLToCMLConverter/List"),i=r.OrderedList,L=r.UnorderedList,C=function getBlock(C,r){var s=null,M=r.tagName&&r.tagName.toLowerCase();switch(M){case"p":s=new c(C,r);break;case"h1":s=new e(C,r,1);break;case"h2":s=new e(C,r,2);break;case"h3":s=new e(C,r,3);break;case"pre":s=new o(C,r);break;case"ol":s=new i(C,r);break;case"ul":s=new L(C,r);break;case"figure":s=new t(C,r);break;case"table":s=new a(C,r);break;case"div":if(-1===r.getAttribute("class").indexOf("cml-asset"))throw new Error('Unsupported HTML element "'+r+", "+M+'"');s=new n(C,r);break;default:throw new Error('Unsupported HTML element "'+r+", "+M+'"')}return s},M=function(){function HTMLToCMLConverter(){_classCallCheck(this,HTMLToCMLConverter)}return HTMLToCMLConverter.prototype.toCML=function toCML(n,o){var t=new window.DOMParser,a=HTMLToCMLConverter.sanitizeHTML(n),e=t.parseFromString("<body>"+a+"</body>","application/xml"),s=e.childNodes[0].childNodes,r=e.createElement("wrapper");return _(s).each(function(o){var n=C(e,o);n&&r.appendChild(n.block)}),HTMLToCMLConverter.getStringifiedCML(r,o)},HTMLToCMLConverter.sanitizeHTML=function sanitizeHTML(e){return e.replace(/&nbsp;/gi," ").replace(/<br[\/]*\>/g,"").replace(/target=\"_blank\"/g,"").replace(/rel=\"noopener\"/g,"").replace(/rel=\"noopener nofollow\"/g,"").replace(/(<img("[^"]*"|[^\/">])*)>/g,"$1/>").replace(/(<source("[^"]*"|[^\/">])*)>/g,"$1/>")},HTMLToCMLConverter.getStringifiedCML=function getStringifiedCML(r,n){var e=s.getInnerContent(r);if(n)return"<co-content>"+e+"</co-content>";return e},HTMLToCMLConverter}();module.exports=M});