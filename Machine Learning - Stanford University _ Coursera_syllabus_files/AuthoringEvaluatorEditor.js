define("bundles/author-code-evaluator/components/AuthoringEvaluatorEditor",["require","exports","module","react","bundles/author-code-evaluator/components/StarterCodeEditor","bundles/author-code-evaluator/components/EvaluatorDraftEditor","bundles/author-code-evaluator/models/StarterCode","bundles/code-evaluator/models/EvaluationRunner","bundles/author-code-evaluator/models/AuthoringEvaluator","bundles/author-code-evaluator/utils/AuthoringEvaluatorAPIUtils","i18n!nls/author-code-evaluator","css!./__styles__/AuthoringEvaluatorEditor"],function(require,exports,module){"use strict";function _defaults(e,o){for(var n=Object.getOwnPropertyNames(o),t=0;t<n.length;t++){var a=n[t],r=Object.getOwnPropertyDescriptor(o,a);r&&r.configurable&&void 0===e[a]&&Object.defineProperty(e,a,r)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var r,o,n,e=require("react"),i=require("bundles/author-code-evaluator/components/StarterCodeEditor"),l=require("bundles/author-code-evaluator/components/EvaluatorDraftEditor"),d=require("bundles/author-code-evaluator/models/StarterCode"),u=require("bundles/code-evaluator/models/EvaluationRunner"),t=require("bundles/author-code-evaluator/models/AuthoringEvaluator"),a=require("bundles/author-code-evaluator/utils/AuthoringEvaluatorAPIUtils"),s=require("i18n!nls/author-code-evaluator");require("css!./__styles__/AuthoringEvaluatorEditor");var c=(o=r=function(r){function AuthoringEvaluatorEditor(t){_classCallCheck(this,AuthoringEvaluatorEditor);var e=_possibleConstructorReturn(this,r.call(this,t));n.call(e);var a=t.starterCode;return e.state={starterCode:a,evaluation:null,evaluationRunner:null,authoringEvaluator:null,publishInProgress:!1,runInProgress:!1},e}return _inherits(AuthoringEvaluatorEditor,r),AuthoringEvaluatorEditor.prototype.componentDidMount=function componentDidMount(){var e=this,r=this.props.publishedEvaluatorId,o=t.getUnversionedId(r);a.get(o).then(function(o){var a=new t(o),r=new u(a.draft.id),n=r.evaluation;e.setState({authoringEvaluator:a,evaluationRunner:r,evaluation:n})})},AuthoringEvaluatorEditor.prototype.render=function render(){var t=this.state,a=t.authoringEvaluator,r=t.starterCode,n=t.evaluation,u=t.runInProgress,o=t.publishInProgress,d=r.language;if(!a)return null;var c=a.draft;return e.createElement("div",{className:"rc-AuthoringEvaluatorEditor"},e.createElement(l,{language:d,evaluatorDraft:c,onChange:this.handleEvaluatorDraftChange}),e.createElement(i,{publishedEvaluatorId:this.props.publishedEvaluatorId,handleRun:this.handleEvaluationRun,starterCode:r,authoringEvaluator:a,evaluation:n,onChange:this.handleStarterCodeChange,onCancel:this.handleEvaluationCancel,runInProgress:u}),e.createElement("div",{className:"horizontal-box align-items-right",style:{paddingTop:40}},e.createElement("div",null,e.createElement("button",{style:{marginRight:20},className:"primary remove-execution-btn",onClick:this.props.onRemove},s("Remove Execution")),e.createElement("button",{disabled:o,className:"primary",onClick:this.handlePublish},s(o?"Publishing...":"Publish")))))},AuthoringEvaluatorEditor}(e.Component),r.propTypes={publishedEvaluatorId:e.PropTypes.string.isRequired,starterCode:e.PropTypes.instanceOf(d).isRequired,onRun:e.PropTypes.func.isRequired,onPublish:e.PropTypes.func.isRequired,onRemove:e.PropTypes.func.isRequired},n=function _initialiseProps(){var e=this;this.handleEvaluationRun=function(){var r=e.state.starterCode.expression;e.setState({runInProgress:!0}),a.save(e.state.authoringEvaluator).then(function(n){var a=new t(n),o=new u(a.draft.id);e.setState({authoringEvaluator:a,evaluationRunner:o,runInProgress:!1}),o.run(r,function(t){return e.setState({evaluation:t})}),e.props.onRun(r)})},this.handleEvaluationCancel=function(){e.state.evaluationRunner.cancel(function(t){return e.setState({evaluation:t})})},this.handleEvaluatorDraftChange=function(r){var a=e.state.authoringEvaluator,o=a.id,n=a.testCases,u=a.metadata,s=new t({id:o,testCases:n,metadata:u,draft:r});e.setState({authoringEvaluator:s})},this.handleStarterCodeChange=function(t){e.setState({starterCode:t})},this.handlePublish=function(){e.setState({publishInProgress:!0}),a.publish(e.state.authoringEvaluator).then(function(a){var r=e.state.starterCode.expression,o=new t(a),n=o.versionedId;e.props.onPublish(n,r)})}},o);module.exports=c});