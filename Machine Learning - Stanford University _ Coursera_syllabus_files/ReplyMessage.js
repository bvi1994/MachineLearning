define("bundles/reply-message/components/ReplyMessage",["require","exports","module","underscore","moment","react","js/lib/coursera.react-intl","bundles/phoenix/template/models/userIdentity","bundles/cml/components/CMLEditor","bundles/cml/constants/CMLEditorBlocks","bundles/teach-course/components/Checkbox","bundles/reply-message/constants/ReplyMessageConstants","bundles/reply-message/utils/ReplyMessageAPIUtils","i18n!nls/reply-message","css!./__styles__/ReplyMessage"],function(require,exports,module){"use strict";function _defaults(e,l){for(var a=Object.getOwnPropertyNames(l),t=0;t<a.length;t++){var s=a[t],n=Object.getOwnPropertyDescriptor(l,s);n&&n.configurable&&void 0===e[s]&&Object.defineProperty(e,s,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var l,r,_=require("underscore"),i=require("moment"),e=require("react"),o=require("js/lib/coursera.react-intl"),a=o.FormattedMessage,g=o.FormattedHTMLMessage,m=require("bundles/phoenix/template/models/userIdentity"),h=require("bundles/cml/components/CMLEditor"),t=require("bundles/cml/constants/CMLEditorBlocks"),d=require("bundles/teach-course/components/Checkbox"),c=require("bundles/reply-message/constants/ReplyMessageConstants"),y=c.EntryTypes,s=c.States,p=require("bundles/reply-message/utils/ReplyMessageAPIUtils"),n=require("i18n!nls/reply-message");require("css!./__styles__/ReplyMessage");var b=[t.H1,t.H2,t.H3,t.Divider,t.Bold,t.Italic,t.Underline,t.Divider,t.Link],u={definition:{dtdId:"email/1",value:"<co-content></co-content>"}},f=(r=l=function(t){function ReplyMessage(){var l,e,a;_classCallCheck(this,ReplyMessage);for(var o=arguments.length,r=Array(o),n=0;o>n;n++)r[n]=arguments[n];return l=e=_possibleConstructorReturn(this,t.call.apply(t,[this].concat(r))),e.state={isMessageBoxOpen:!1,replyState:s.Idle,allowReply:!0,sentTime:null,message:u},e.handleClose=function(){e.setState({isMessageBoxOpen:!1})},e.handleSend=function(){var t=e.props,n=t.entryType,l=t.entryId,a=e.state.allowReply;e.setState({replyState:s.InProgress}),p.sendMessage(n,l,!a,e.state.message).then(function(){e.setState({replyState:s.Success,message:u,sentTime:Date.now()}),e.handleClose()})},e.handleButtonClick=function(){e.setState({isMessageBoxOpen:!0}),p.getSentMessage(e.props.entryId).then(function(t){if(!_(t.elements).isEmpty()){var n=t.elements[0].metadata;e.setState({replyState:s.Success,sentTime:n.updatedAt})}})},e.handleMessageChange=function(t){e.setState({message:t})},e.handleAllowReply=function(t){e.setState({allowReply:t})},a=l,_possibleConstructorReturn(e,a)}return _inherits(ReplyMessage,t),ReplyMessage.prototype.render=function render(){var p=this.props,f=p.placeholder,y=p.buttonText,t=this.state,o=t.isMessageBoxOpen,u=t.allowReply,l=t.replyState,c=t.sentTime,S=t.message,r=l===s.InProgress;return e.createElement("div",{className:"rc-ReplyMessage"},o&&e.createElement("div",null,l===s.Success&&e.createElement("div",{className:"sent-reply-timestamp"},e.createElement(a,{message:n("Reply sent {time}"),time:i(c).format("lll")})),e.createElement(h,{cml:S,isFocused:!0,blocks:b,placeholder:f,onChange:this.handleMessageChange}),e.createElement("footer",{className:"send-message-footer"},e.createElement("span",{className:"send-options"},e.createElement("label",null,e.createElement(d,{onChange:this.handleAllowReply,checked:u}),e.createElement(g,{message:n("Allow learner to reply to you at <strong>{email}</strong>"),email:m.get("email_address")}))),e.createElement("button",{className:"link-styled-button cancel-button",onClick:this.handleClose},n("Cancel")),e.createElement("button",{disabled:r,className:"teach-btn teach-btn-primary",onClick:this.handleSend},n(r?"Sending...":"Send")))),!o&&e.createElement("button",{className:"link-styled-button",onClick:this.handleButtonClick},l===s.Success&&e.createElement(a,{message:n("Reply sent {time}"),time:i(c).format("lll")}),l!==s.Success&&y))},ReplyMessage}(e.Component),l.propTypes={entryId:e.PropTypes.any.isRequired,entryType:e.PropTypes.oneOf(_(y).toArray()).isRequired,placeholder:e.PropTypes.string,buttonText:e.PropTypes.string,title:e.PropTypes.string},l.defaultProps={placeholder:n("Write a message"),buttonText:n("Reply")},r);module.exports=f});