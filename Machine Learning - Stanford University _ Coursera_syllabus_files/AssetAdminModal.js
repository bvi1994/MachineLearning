define("bundles/asset-admin/components/AssetAdminModal",["require","exports","module","react","vendor/cnpm/fluxible.v0-4/addons/connectToStores","vendor/cnpm/fluxible.v0-4/addons/FluxibleComponent","classnames","underscore","i18n!nls/asset-admin","bundles/phoenix/components/Modal","bundles/teach-course/components/BounceLoader","bundles/asset-admin/app","bundles/asset-admin/actions/AssetAdminActions","./AssetBrowser","./AssetUploader","./AssetsFooter","./NoticeMessage","bundles/asset-admin/constants/UploadStatus","css!./__styles__/AssetAdminModal"],function(require,exports,module){"use strict";function _defaults(e,n){for(var a=Object.getOwnPropertyNames(n),t=0;t<a.length;t++){var s=a[t],o=Object.getOwnPropertyDescriptor(n,s);o&&o.configurable&&void 0===e[s]&&Object.defineProperty(e,s,o)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var s,n,e=require("react"),h=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),p=require("vendor/cnpm/fluxible.v0-4/addons/FluxibleComponent"),l=require("classnames"),_=require("underscore"),a=require("i18n!nls/asset-admin"),T=require("bundles/phoenix/components/Modal"),d=require("bundles/teach-course/components/BounceLoader"),i=require("bundles/asset-admin/app"),o=require("bundles/asset-admin/actions/AssetAdminActions"),c=o.initializeModal,u=o.getAssetsListByCourse,m=o.resetAssets,A=require("./AssetBrowser"),b=require("./AssetUploader"),f=require("./AssetsFooter"),y=require("./NoticeMessage"),r=require("bundles/asset-admin/constants/UploadStatus");require("css!./__styles__/AssetAdminModal");var t={Assets:"assets",Upload:"upload"},v=(n=s=function(s){function AssetAdminModal(o,n){_classCallCheck(this,AssetAdminModal);var e=_possibleConstructorReturn(this,s.call(this,o,n));return e.handleClose=function(){e.props.uploadStatus.state!==r.IN_PROGRESS&&e.props.onCancel()},e.selectTab=function(s){if(s!==e.state.activeTabId&&e.props.uploadStatus.state!==r.IN_PROGRESS&&(e.setState({activeTabId:s}),e.context.executeAction(m),s===t.Assets)){var o=e.props,n=o.courseId,a=o.assetType;e.context.executeAction(u,{courseId:n,assetType:a})}},e.state={activeTabId:o.tab},e}return _inherits(AssetAdminModal,s),AssetAdminModal.prototype.componentWillMount=function componentWillMount(){var e=this.props,s=e.courseId,o=e.assetType,n=e.tab,a=e.hideHeaderTabs,l=n===t.Upload&&a;this.context.executeAction(c,{courseId:s,assetType:o,hideAssets:l})},AssetAdminModal.prototype.componentDidUpdate=function componentDidUpdate(){var e=this.props,t=e.onSelect,s=e.uploadedAssets,o=e.allowMultiple;t&&AssetAdminModal.shouldReturnUploadedAssets(s,o)&&t(s)},AssetAdminModal.prototype.renderActiveTabId=function renderActiveTabId(){var s=this.props,o=s.course,u=s.assets,l=s.assetType,r=s.pdfTemplate,n=s.allowMultiple,p=s.isNoticeMessageDismissed,c=s.uploadedAssets,a=s.selectedAssets,m=s.uploadAttempts,f=s.uploadStatus,i=s.nextPageIndex;if(!o)return e.createElement("div",{className:"initial-loading"},e.createElement(d,null));return this.state.activeTabId===t.Upload?e.createElement(b,{course:o,assetType:l,pdfTemplate:r,allowMultiple:n,uploadedAssets:c,selectedAssets:a,uploadAttempts:m,uploadStatus:f}):e.createElement("div",null,e.createElement("h2",{className:"folder-name"},o.name),e.createElement(A,{assets:u,allowMultiple:n,selectedAssets:a,courseId:o.id,nextPageIndex:i}),e.createElement(y,{dismissed:p}))},AssetAdminModal.prototype.render=function render(){var s=this.props,n=s.hideFooter,r=s.selectedAssets,i=s.uploadedAssets,o=s.hideHeaderTabs,p=s.hideSelectButton,c=s.onSelect,u=s.onCancel,m=l({active:this.state.activeTabId===t.Assets}),d=l({active:this.state.activeTabId===t.Upload});return e.createElement("div",{className:"rc-AssetAdminModal"},e.createElement(T,{modalName:"AssetAdminModal",handleClose:this.handleClose},!o&&e.createElement("header",{className:"asset-modal-header"},e.createElement("button",{className:m+" button-link",onClick:_(this.selectTab).partial(t.Assets)},a("Assets")),e.createElement("button",{className:d+" button-link",onClick:_(this.selectTab).partial(t.Upload)},a("Upload"))),e.createElement("div",{className:"asset-modal-content"},this.renderActiveTabId()),!n&&e.createElement(f,{selectedAssets:r,uploadedAssets:i,onSelect:c,onCancel:u,hideSelectButton:p})))},AssetAdminModal}(e.Component),s.propTypes={courseId:e.PropTypes.string.isRequired,course:e.PropTypes.object,assets:e.PropTypes.array,assetType:e.PropTypes.oneOf(["image","video","subtitle","pdf","audio","generic"]),pdfTemplate:e.PropTypes.oneOf(["slides"]),tab:e.PropTypes.oneOf([t.Assets,t.Upload]),nextPageIndex:e.PropTypes.string,hideHeaderTabs:e.PropTypes.bool,hideFooter:e.PropTypes.bool,hideSelectButton:e.PropTypes.bool,allowMultiple:e.PropTypes.bool,selectedAssets:e.PropTypes.array,uploadedAssets:e.PropTypes.array,uploadAttempts:e.PropTypes.object,uploadStatus:e.PropTypes.object,onSelect:e.PropTypes.func,onCancel:e.PropTypes.func.isRequired,isNoticeMessageDismissed:e.PropTypes.bool},s.contextTypes={executeAction:e.PropTypes.func.isRequired},s.defaultProps={tab:t.Assets,allowMultiple:!0},s.shouldReturnUploadedAssets=function(e,t){return t&&e.length>0||!t&&1===e.length},n),x=h(v,["AssetAdminStore"],function(t,s){var e=t.AssetAdminStore;return{course:e.getCourse(),assets:e.getAssets(),nextPageIndex:e.getNextPageIndex(),selectedAssets:e.getSelectedAssets(),uploadStatus:e.getUploadStatus(),uploadedAssets:e.getUploadedAssets(),uploadAttempts:e.getUploadAttempts(),isNoticeMessageDismissed:e.isNoticeMessageDismissed()}}),g=function(t){function FluxibleAssetAdminModal(){return _classCallCheck(this,FluxibleAssetAdminModal),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(FluxibleAssetAdminModal,t),FluxibleAssetAdminModal.prototype.componentWillMount=function componentWillMount(){this.fluxibleContext=i.createContext()},FluxibleAssetAdminModal.prototype.render=function render(){return e.createElement(p,{context:this.fluxibleContext.getComponentContext()},e.createElement(x,this.props))},FluxibleAssetAdminModal}(e.Component);module.exports=g});